
## Integrações

Esta seção descreve como o sistema se integra com APIs externas de plataformas como Google e Facebook para rastreamento, conversões e marketing.

### 1. Google (Google Ads, Google Analytics 4, Google Tag Manager, Merchant Center)

#### a) Captura de Parâmetros UTM e `gclid`
*   **Descrição:** O sistema deve capturar automaticamente os parâmetros UTM (ex: `utm_source`, `utm_medium`, `utm_campaign`) e o `gclid` (Google Click Identifier) da URL da primeira visita do usuário.
*   **Armazenamento:** Esses parâmetros devem ser armazenados associados ao usuário (se logado) ou a um identificador anônimo (ex: via cookie) para uso posterior.
*   **Objetivo:** Atribuir conversões (pedidos) ao canal de tráfego e anúncio correto.

#### b) Disparo de Eventos para Google Analytics 4 (GA4)
*   **Descrição:** Disparar eventos específicos para o Google Analytics 4 usando o `gtag.js` ou via Google Tag Manager (ver abaixo).
*   **Eventos Padrão:**
    *   `page_view`: Disparado em cada carregamento de página.
    *   `sign_up`: Disparado quando um usuário se cadastra.
    *   `begin_checkout`: Disparado quando o usuário clica em "Ir para pagamento".
    *   `add_to_cart`: Disparado quando um item é adicionado ao carrinho.
    *   `view_cart`: Disparado quando o usuário acessa a página do carrinho.
    *   `purchase`: Disparado na página de "Obrigado", com detalhes como `transaction_id`, `value`, `currency`, `items`, e o `gclid` original.
    *   `cart_abandonment`: Disparado se o usuário sair do carrinho sem concluir o pedido (lógica de timeout ou navegação).
*   **Dados Enviados:** Devem incluir o valor total, ID do pedido, itens do pedido e o `gclid` original para atribuição correta.

#### c) Disparo de Conversões para Google Ads
*   **Descrição:** Disparar eventos de conversão para o Google Ads, preferencialmente via API (Google Ads Conversion Tracking API) ou via Google Tag Manager.
*   **Evento:** `purchase` (ou um evento de conversão personalizado definido no Google Ads).
*   **Dados Enviados:** ID da conversão, `gclid` original, valor do pedido, moeda, e possivelmente o ID do pedido. O `gclid` é crucial para vincular a conversão ao clique original do anúncio.

#### d) Injeção de Google Tag Manager (GTM)
*   **Descrição:** Permitir a injeção de um ou mais containers do Google Tag Manager (IDs separados por vírgula ou lista).
*   **Objetivo:** Facilitar a configuração e o gerenciamento de tags (analytics, conversões, pixels) via interface do GTM, sem alterar o código do site diretamente.

#### e) Sincronização com Google Merchant Center
*   **Descrição:** Sincronizar automaticamente os produtos do catálogo do SushiWorld com um ou mais perfis do Google Merchant Center.
*   **Dados Sincronizados:** Nome, descrição, preço, imagem (`imagem_url` do banco de dados), SKU, categoria, disponibilidade.

### 2. Facebook (Meta) (Facebook Pixel, Meta Conversions API, Catálogo)

#### a) Captura de `fbclid`
*   **Descrição:** Capturar o `fbclid` (Facebook Click Identifier) da URL da primeira visita do usuário.
*   **Armazenamento:** Associado ao usuário ou identificador anônimo.
*   **Objetivo:** Atribuir conversões ao anúncio do Facebook que gerou o clique.

#### b) Disparo de Eventos para Facebook Pixel
*   **Descrição:** Disparar eventos padrão e personalizados para o Facebook Pixel instalado.
*   **Eventos Padrão:**
    *   `PageView`: Disparado em cada carregamento de página.
    *   `CompleteRegistration`: Disparado quando um usuário se cadastra.
    *   `InitiateCheckout`: Disparado quando o usuário clica em "Ir para pagamento".
    *   `AddToCart`: Disparado quando um item é adicionado ao carrinho.
    *   `Purchase`: Disparado na página de "Obrigado", com valor total, conteúdo do carrinho e `currency`.
*   **Dados Enviados:** Devem incluir conteúdo do evento (ex: `content_ids`, `content_name`), valor total, moeda, e o `fbclid` original.

#### c) Disparo de Eventos via Meta Conversions API (CAPI)
*   **Descrição:** Disparar os mesmos eventos do Pixel, mas **server-side** via Meta Conversions API.
*   **Vantagem:** Mais confiável e seguro, pois os dados são enviados diretamente do servidor do SushiWorld para o Meta, evitando bloqueios de script no navegador.
*   **Dados Enviados:** Inclui informações do cliente (hash de email, telefone), IP, User Agent, URL da página, tipo de evento, nome do evento, valor, conteúdo do carrinho, e o `fbclid` original.
*   **Implementação:** Requer o envio de um `event_id` único por evento para evitar duplicações.

#### d) Sincronização com Catálogo do Facebook
*   **Descrição:** Sincronizar automaticamente os produtos do catálogo do SushiWorld com um ou mais catálogos do Facebook.
*   **Dados Sincronizados:** Nome, descrição, preço, imagem (`imagem_url` do banco de dados), SKU, categoria, disponibilidade.

### 3. Configuração no Painel Administrativo

*   **Campos de Configuração:** O painel administrativo deve ter seções para inserir e gerenciar:
    *   **Google:**
        *   Measurement ID do GA4.
        *   Container ID do GTM (pode ser mais de um).
        *   ID de conversão do Google Ads.
        *   Credenciais/IDs para Merchant Center (pode ser mais de um).
    *   **Facebook:**
        *   Pixel ID do Facebook.
        *   Access Token para Conversions API.
        *   ID do Catálogo do Facebook (pode ser mais de um).
*   **Ativação/Desativação:** Permitir ativar ou desativar cada integração individualmente.
*   **Testes:** Botões para testar o envio de eventos para cada plataforma integrada.

...
Via Feed (Recomendado): O site deve gerar um feed de produtos (um arquivo .txt, .csv ou .json) e fornecer a URL para o Facebook importar.
Formato do Feed (exemplo .csv):
O Facebook espera um arquivo .csv com colunas específicas. O formato básico para produtos de comida/delivery pode ser simplificado, mas deve incluir campos obrigatórios.
id	title	description	availability	condition	price	link	image_link	brand	google_product_category	product_type	quantity_to_sell_on_facebook	item_group_id	checkout_url	sale_price	sale_price_effective_date	tax	shipping	shipping_weight	shipping_size	shipping_length	shipping_width	shipping_height	gender	age_group	color	size	pattern	material	return_policy_label	size_system	size_type	variant		

Campos Importantes:

id: SKU ou ID único do produto no seu sistema.
title: Nome do produto (ex: "Nigiri Salmão").
description: Descrição do produto (ex: "Nigiri de salmão fresco").
availability: "in stock", "out of stock".
condition: Geralmente "new".
price: Preço no formato X.XX CURRENCY (ex: 3.50 EUR).
link: URL da página do produto no seu site.
image_link: URL direta para a imagem do produto (ex: https://sushiworld.pt/produtos/1.webp).
brand: Nome da sua marca (SushiWorld).
google_product_category: Opcional, mas recomendado. Use códigos do Google (ex: "Food & Dining > Restaurants").
product_type: Categoria hierárquica (ex: "Sushi", "Poke").
quantity_to_sell_on_facebook: Quantidade disponível para venda via Facebook (opcional, pode ser gerenciado no site).
item_group_id: Para produtos com variações (ex: diferentes sabores do mesmo tipo de poke), use o mesmo item_group_id. Se não houver variações, use o id do produto.
checkout_url: URL para finalizar a compra (opcional, geralmente o link é suficiente).
sale_price e sale_price_effective_date: Se o produto estiver em promoção.
tax: Informações de imposto (opcional).
shipping: Informações de frete (opcional).
gender, age_group, color, size, pattern, material: Geralmente não aplicáveis para comida, deixe em branco.
return_policy_label, size_system, size_type, variant: Geralmente não aplicáveis para comida, deixe em branco.
Como o Site Sincroniza (Código vs API):
Código (Feed de Arquivo):
Implementação: O painel administrativo do SushiWorld deve ter uma opção para gerar automaticamente o feed de produtos (.csv, .txt ou .json) com base nos produtos cadastrados no banco de dados.
Exemplo: Um botão "Exportar Catálogo para Facebook" no painel.
Configuração no Facebook: No Commerce Manager, você adiciona uma fonte de dados ao seu catálogo. Escolha "Upload de Arquivo" e forneça a URL pública onde o arquivo .csv gerado pelo site está hospedado (ex: https://sushiworld.pt/api/facebook-catalog.csv). O Facebook irá importar esse arquivo periodicamente (ex: diariamente).
Vantagem: Mais simples de implementar inicialmente.
Desvantagem: Menor frequência de atualização (geralmente diária), e o arquivo precisa estar disponível publicamente.
API (Facebook Commerce API):
Implementação: O painel administrativo deve ter uma opção para enviar/atualizar produtos diretamente para o catálogo do Facebook via API.
Exemplo: Um botão "Sincronizar com Facebook" que faz chamadas HTTP para a API do Facebook para adicionar/alterar/excluir produtos.
Configuração no Facebook: Você precisa configurar um Acesso de Aplicativo (App Access Token) ou Acesso de Página (Page Access Token) com as permissões corretas (catalog_management, pages_show_list, etc.). Isso é mais complexo e envolve autenticação via o facebook-graph-api.
Vantagem: Atualizações em tempo real ou quase real, mais controle.
Desvantagem: Implementação mais complexa, exige gerenciamento de tokens e chamadas API.
Configuração no Painel Administrativo (SushiWorld):
Campos para Configuração:
IDs de Catálogos do Facebook: Permitir adicionar um ou mais IDs de catálogos do Facebook (ex: 1234567890123456).
Token de Acesso (se for usar API): Campo para inserir o token de acesso da página ou do app com permissão de catálogo.
URL do Feed (se for usar Feed): Campo para exibir ou configurar a URL pública do feed gerado (ex: https://sushiworld.pt/api/facebook-catalog.csv).
Botões: "Exportar Feed" (gera .csv) e "Sincronizar via API" (envia dados via API).
Ativação/Desativação: Permitir ativar ou desativar a sincronização com cada catálogo individualmente.

Google Merchant Center (Catálogo do Google / Google Business Profile)
Objetivo:
Deixar o site pronto para Sincronizar produtos com o Google Merchant Center para que eles apareçam em anúncios do Google Shopping, Google Maps, Google Business Profile (perfil do Google), etc.
Escolha o formato (recomendado: .csv ou .json).
Criar ou Fornecer o Feed de Produtos:
Assim como no Facebook, o Google espera um feed de produtos.
Formato do Feed (exemplo .csv):
id	title	description	link	image_link	content_language	target_country	channel	availability	price	sale_price	google_product_category	product_type	brand	gtin	mpn	condition	item_group_id	shipping	shipping_weight	shipping_length	shipping_width	shipping_height	color	size	gender	age_group	tax	tax_rate	tax_country	tax_region	tax_ship	is_bundle	multipack	custom_label_0	custom_label_1	custom_label_2	custom_label_3	custom_label_4	installments	installment_months	installment_amount	price_unit	sale_price_effective_date		

Campos Importantes:

id: SKU ou ID único do produto.
title: Nome do produto.
description: Descrição do produto.
link: URL da página do produto no seu site.
image_link: URL direta para a imagem do produto.
content_language: Idioma do conteúdo (ex: pt).
target_country: País alvo (ex: PT).
channel: Geralmente online.
availability: "in stock", "out of stock".
price: Preço no formato X.XX CURRENCY.
sale_price: Preço de venda promocional (opcional).
google_product_category: Código da categoria do Google (ex: "Food & Dining > Restaurants").
product_type: Categoria hierárquica (ex: "Sushi", "Poke").
brand: Nome da sua marca.
gtin, mpn: Geralmente não aplicáveis para comida feita na hora.
condition: Geralmente "new".
item_group_id: Para variações, mesmo conceito do Facebook.
shipping, shipping_weight, shipping_length, shipping_width, shipping_height: Opcional, mas útil se o Google calcular frete.
color, size, gender, age_group: Geralmente não aplicáveis.
tax: Opcional.
is_bundle, multipack, custom_label_0 a 4: Opcionais.
installments, installment_months, installment_amount: Opcionais.
price_unit: Opcional (ex: "kg").
sale_price_effective_date: Opcional (data de início e fim da promoção).
Como o Site Sincroniza (Código vs API):
Código (Feed de Arquivo):
Implementação: O painel administrativo do SushiWorld deve gerar automaticamente o feed de produtos (.csv ou .json) com base nos produtos do banco de dados.
Configuração no Google Merchant Center: No painel do Merchant Center, você adiciona uma fonte de dados e configura para buscar o feed em uma URL específica (ex: https://sushiworld.pt/api/google-merchant-feed.csv). O Google irá importar esse feed periodicamente.
Vantagem: Simples de implementar.
Desvantagem: Menor frequência de atualização, o arquivo precisa estar disponível publicamente.
API (Google Merchant Center API):
Implementação: Envio direto de produtos via chamadas HTTP para a API do Google Merchant Center. Requer autenticação via OAuth 2.0 e o uso de uma Service Account.
Exemplo: Um botão "Sincronizar com Google Merchant" no painel do SushiWorld que faz chamadas para a API para gerenciar os produtos.
Vantagem: Atualizações em tempo real, mais controle.
Desvantagem: Implementação mais complexa, envolve OAuth e Service Accounts.
Configuração no Painel Administrativo (SushiWorld):
Campos para Configuração:
IDs de Conta do Merchant Center: Permitir adicionar um ou mais IDs de conta do Google Merchant Center.
Credenciais de API (se for usar API): Campos para inserir as credenciais OAuth ou Service Account.
URL do Feed (se for usar Feed): Campo para exibir ou configurar a URL pública do feed gerado (ex: https://sushiworld.pt/api/google-merchant-feed.csv).
Botões: "Exportar Feed" (gera .csv) e "Sincronizar via API" (envia dados via API).
Ativação/Desativação: Permitir ativar ou desativar a sincronização com cada conta/perfil do Google individualmente.
Conclusão:
Para atender ao modelo de prompt e deixar o site pronto para integração com Facebook e Google:

No código do site (Next.js): Implemente funções para gerar feeds de produtos (.csv, .json) com base no banco de dados do Supabase.
No painel administrativo (Next.js + Supabase): Crie uma seção de "Integrações" onde o administrador possa:
Inserir IDs de catálogos do Facebook e do Google Merchant Center.
Inserir tokens/chaves de API (se for usar API).
Visualizar URLs dos feeds gerados.
Acionar botões para gerar o feed ou sincronizar via API.
Ativar/desativar cada integração.
No Facebook Commerce Manager e Google Merchant Center: Configure as fontes de dados para apontar para os feeds gerados pelo site ou para receber dados via API, conforme configurado no painel do SushiWorld.
Dessa forma, você terá uma solução flexível e completa para integrar os produtos do seu site com os principais canais de marketing e vendas online.