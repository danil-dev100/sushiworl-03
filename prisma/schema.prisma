// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL") // Pooler (porta 6543) - para runtime e migrations
}

// ============================================
// USU√ÅRIOS E AUTENTICA√á√ÉO
// ============================================

model User {
  id           String        @id @default(cuid())
  email        String        @unique
  name         String
  phone        String?
  password     String? // Hash da senha (apenas para admin/managers)
  role         Role          @default(CUSTOMER)
  managerLevel ManagerLevel? // N√≠vel de acesso para gerentes

  // Tracking de marketing (apenas para clientes)
  gclid       String?
  fbclid      String?
  utmSource   String?
  utmMedium   String?
  utmCampaign String?
  utmTerm     String?
  utmContent  String?

  // Estat√≠sticas do cliente
  totalSpent Float @default(0)
  orderCount Int   @default(0)

  // Controle
  firstLogin Boolean  @default(true) // Para for√ßar troca de senha
  isActive   Boolean  @default(true)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  orders            Order[]
  emailCampaignLogs EmailCampaignLog[]
}

// ============================================
// CATEGORIAS
// ============================================

model Category {
  id        String   @id @default(cuid())
  name      String   @unique
  emoji     String   @default("üçΩÔ∏è")
  order     Int      @default(0) // Ordem de exibi√ß√£o
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("categories")
}

// ============================================
// PRODUTOS
// ============================================

model Product {
  id            String  @id @default(cuid())
  sku           String  @unique
  name          String  @db.VarChar(100)
  description   String? @db.VarChar(300)
  price         Float
  discountPrice Float?
  category      String
  imageUrl      String
  ogImageUrl    String? // Imagem para redes sociais
  ogDescription String? // Descri√ß√£o para redes sociais

  // Status e visibilidade
  status          ProductStatus @default(AVAILABLE)
  isVisible       Boolean       @default(true)
  isFeatured      Boolean       @default(false) // Para "Destaques"
  isTopSeller     Boolean       @default(false) // Para "Mais Vendidos"
  featuredOrder   Int? // Ordem em Destaques (1, 2 ou 3)
  bestSellerOrder Int? // Ordem em Mais Vendidos (1, 2 ou 3)

  // Disponibilidade
  availableUntil DateTime? // Data espec√≠fica de disponibilidade
  outOfStock     Boolean   @default(false)

  // Configura√ß√µes do produto
  isHot        Boolean @default(false)
  isHalal      Boolean @default(false)
  isVegan      Boolean @default(false)
  isVegetarian Boolean @default(false)
  isDairyFree  Boolean @default(false)
  isRaw        Boolean @default(false)
  isGlutenFree Boolean @default(false)
  isNutFree    Boolean @default(false)

  // Informa√ß√µes detalhadas
  ingredients String?  @db.Text // At√© 2000 caracteres
  additives   String?  @db.Text // At√© 2000 caracteres
  allergens   String[] // Array de al√©rgenos
  tags        String[] // Tags do produto

  // Valores nutricionais
  nutritionPer NutritionPer? // Por servi√ßo ou por 100g
  calories     Float?
  carbs        Float?
  totalFat     Float?
  protein      Float?
  sugar        Float?
  salt         Float?

  // Metadados
  orderCount Int @default(0) // Para calcular "mais vendidos"
  viewCount  Int @default(0) // Para analytics

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  orderItems      OrderItem[]
  productOptions  ProductOption[]
  promotionItems  PromotionItem[]
  smartPromotions SmartPromotion[]
}

model ProductOption {
  id        String @id @default(cuid())
  productId String

  name        String     @db.VarChar(80)
  type        OptionType // REQUIRED ou OPTIONAL
  description String?    @db.VarChar(150)

  // Configura√ß√µes
  minSelection  Int       @default(0)
  maxSelection  Int       @default(1)
  allowMultiple Boolean   @default(false)
  displayAt     DisplayAt @default(CART) // SITE ou CART
  isPaid        Boolean   @default(false) // Se a op√ß√£o base √© paga
  basePrice     Float     @default(0) // Pre√ßo base da op√ß√£o (se isPaid = true)

  isActive  Boolean @default(true)
  sortOrder Int     @default(0)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  product Product               @relation(fields: [productId], references: [id], onDelete: Cascade)
  choices ProductOptionChoice[]
}

model ProductOptionChoice {
  id       String @id @default(cuid())
  optionId String

  name      String  @db.VarChar(80)
  price     Float   @default(0) // Valor adicional
  isDefault Boolean @default(false) // Pr√©-selecionado
  isActive  Boolean @default(true)
  sortOrder Int     @default(0)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  option ProductOption @relation(fields: [optionId], references: [id], onDelete: Cascade)
}

// ============================================
// OP√á√ïES GLOBAIS (Biblioteca de Op√ß√µes Reutiliz√°veis)
// ============================================

model GlobalOption {
  id          String     @id @default(cuid())
  name        String     @db.VarChar(80)
  type        OptionType @default(OPTIONAL)
  description String?    @db.VarChar(150)
  displayAt   DisplayAt  @default(CART)
  isPaid      Boolean    @default(false)
  basePrice   Float      @default(0)
  isActive    Boolean    @default(true)
  sortOrder   Int        @default(0)
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt

  choices     GlobalOptionChoice[]
  assignments GlobalOptionAssignment[]

  @@index([isActive])
}

model GlobalOptionChoice {
  id        String   @id @default(cuid())
  optionId  String
  name      String   @db.VarChar(80)
  price     Float    @default(0)
  isDefault Boolean  @default(false)
  isActive  Boolean  @default(true)
  sortOrder Int      @default(0)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  option GlobalOption @relation(fields: [optionId], references: [id], onDelete: Cascade)

  @@index([optionId])
}

model GlobalOptionAssignment {
  id             String         @id @default(cuid())
  globalOptionId String
  assignmentType AssignmentType
  targetId       String? // categoryId ou productId (null se SITE_WIDE)
  minSelection   Int            @default(0)
  maxSelection   Int            @default(1)
  allowMultiple  Boolean        @default(false)
  sortOrder      Int            @default(0)
  createdAt      DateTime       @default(now())
  updatedAt      DateTime       @updatedAt

  globalOption GlobalOption @relation(fields: [globalOptionId], references: [id], onDelete: Cascade)

  @@unique([globalOptionId, assignmentType, targetId])
  @@index([globalOptionId])
  @@index([assignmentType])
  @@index([targetId])
}

// ============================================
// PEDIDOS
// ============================================

model Order {
  id          String  @id @default(cuid())
  orderNumber Int     @unique @default(autoincrement()) // N√∫mero √∫nico sequencial
  userId      String?

  // Dados do cliente
  customerName  String
  customerEmail String
  customerPhone String
  customerNif   String?

  // Endere√ßo de entrega
  deliveryAddress Json // {street, number, neighborhood, city, postalCode, coordinates}
  deliveryAreaId  String?
  deliveryFee     Float   @default(0)

  // Log de decis√£o de entrega (auditoria)
  deliveryDecisionLog Json? // {coordinates, displayName, confidence, method, matchedAreaName, priority, timestamp}

  // Valores
  subtotal  Float
  discount  Float @default(0)
  vatAmount Float @default(0)
  total     Float

  // Itens adicionais do checkout (talheres, guardanapos, etc.)
  checkoutAdditionalItems Json? // [{name: string, price: number, isRequired: boolean}]

  // Pagamento
  status        OrderStatus   @default(PENDING)
  paymentMethod PaymentMethod @default(CASH)
  changeFor     Float?

  // Promo√ß√µes
  couponCode  String?
  promotionId String?

  // Observa√ß√µes
  observations String? @db.Text

  // Tracking
  gclid     String?
  fbclid    String?
  utmSource String?

  // Pedidos de teste (criados no painel admin para demonstra√ß√£o)
  isTest Boolean @default(false)

  // Controle
  acceptedAt  DateTime?
  cancelledAt DateTime?
  deliveredAt DateTime?
  printedAt   DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user         User?          @relation(fields: [userId], references: [id])
  deliveryArea DeliveryArea?  @relation(fields: [deliveryAreaId], references: [id])
  promotion    Promotion?     @relation(fields: [promotionId], references: [id])
  orderItems   OrderItem[]
  printHistory PrintHistory[]

  @@index([orderNumber])
  @@index([status])
  @@index([createdAt])
}

model OrderItem {
  id        String @id @default(cuid())
  orderId   String
  productId String

  name        String // Nome do produto no momento
  quantity    Int
  priceAtTime Float

  // Op√ß√µes selecionadas (JSON com as escolhas)
  selectedOptions Json?

  createdAt DateTime @default(now())

  order   Order   @relation(fields: [orderId], references: [id], onDelete: Cascade)
  product Product @relation(fields: [productId], references: [id])
}

model PrintHistory {
  id      String @id @default(cuid())
  orderId String

  printerName  String?
  paperSize    String? // 58mm, 80mm
  status       PrintStatus @default(SUCCESS)
  errorMessage String?

  printedAt DateTime @default(now())

  order Order @relation(fields: [orderId], references: [id], onDelete: Cascade)
}

// ============================================
// √ÅREAS DE ENTREGA
// ============================================

model DeliveryArea {
  id   String @id @default(cuid())
  name String

  // Pol√≠gono (array de coordenadas)
  polygon Json // [[lat, lng], [lat, lng], ...]
  color   String @default("#3B82F6") // Cor no mapa

  // Configura√ß√£o de entrega
  deliveryType  DeliveryType
  deliveryFee   Float        @default(0)
  minOrderValue Float? // Valor m√≠nimo para frete gr√°tis

  // Contextos de busca para geocodifica√ß√£o (cidades/concelhos)
  // TEMPORARIAMENTE DESABILITADO - Execute o script SQL em scripts/add-search-contexts-column.sql
  // searchContexts  String[] @default([]) // Melhora precis√£o da busca de endere√ßos

  // Prioridade para √°reas sobrepostas (maior = maior prioridade)
  priority Int @default(0)

  isActive  Boolean @default(true)
  sortOrder Int     @default(0)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  orders Order[]
}

// ============================================
// PROMO√á√ïES E MARKETING
// ============================================

model Promotion {
  id   String        @id @default(cuid())
  name String
  code String?       @unique // C√≥digo do cupom (se aplic√°vel)
  type PromotionType

  // Configura√ß√£o do desconto
  discountType  DiscountType // FIXED ou PERCENTAGE
  discountValue Float
  minOrderValue Float?

  // Configura√ß√£o de exibi√ß√£o
  title       String? @db.VarChar(35)
  description String? @db.VarChar(100)
  imageUrl    String?

  // Regras de aplica√ß√£o
  triggerType  TriggerType? // PRODUCT, CATEGORY, CART
  triggerValue String? // ID do produto/categoria

  // Up-sell/Down-sell espec√≠fico
  suggestedProductId String?
  displayMessage     String? @db.Text

  // Controle
  isActive            Boolean @default(true)
  isFirstPurchaseOnly Boolean @default(false)

  // Limites
  usageLimit Int? // Limite total de usos
  usageCount Int  @default(0)

  // Validade
  validFrom  DateTime?
  validUntil DateTime?

  // Hor√°rio (opcional)
  timeRestriction Json? // {startHour, endHour}

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  orders         Order[]
  promotionItems PromotionItem[]
}

model PromotionItem {
  id          String @id @default(cuid())
  promotionId String
  productId   String

  sortOrder Int @default(0)

  promotion Promotion @relation(fields: [promotionId], references: [id], onDelete: Cascade)
  product   Product   @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@unique([promotionId, productId])
}

// ============================================
// EMAIL MARKETING
// ============================================

model EmailCampaign {
  id      String @id @default(cuid())
  name    String
  subject String

  // Conte√∫do
  htmlContent String  @db.Text
  textContent String? @db.Text

  // Tipo e trigger
  type    EmailType
  trigger EmailTrigger?

  // Configura√ß√µes
  fromName  String @default("SushiWorld")
  fromEmail String @default("pedidosushiworld@gmail.com")

  // Controle
  isActive Boolean @default(true)

  // Estat√≠sticas
  sentCount  Int @default(0)
  openCount  Int @default(0)
  clickCount Int @default(0)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  logs EmailCampaignLog[]
}

model EmailCampaignLog {
  id         String  @id @default(cuid())
  campaignId String
  userId     String?

  email  String
  status EmailStatus

  sentAt    DateTime  @default(now())
  openedAt  DateTime?
  clickedAt DateTime?

  campaign EmailCampaign @relation(fields: [campaignId], references: [id], onDelete: Cascade)
  user     User?         @relation(fields: [userId], references: [id])

  @@index([email])
  @@index([sentAt])
}

// ============================================
// ANALYTICS
// ============================================

model AnalyticsEvent {
  id String @id @default(cuid())

  // Evento
  eventName String // page_view, add_to_cart, purchase, etc.
  eventData Json? // Dados adicionais do evento

  // Tracking
  sessionId   String?
  userId      String?
  gclid       String?
  fbclid      String?
  utmSource   String?
  utmMedium   String?
  utmCampaign String?

  // P√°gina
  pageUrl  String?
  referrer String?

  // Device
  userAgent String?
  ipAddress String?

  createdAt DateTime @default(now())

  @@index([eventName])
  @@index([sessionId])
  @@index([createdAt])
}

model UTMLink {
  id String @id @default(cuid())

  // URL e Par√¢metros
  url         String
  utmSource   String
  utmMedium   String
  utmCampaign String
  utmTerm     String?
  utmContent  String?

  // Link completo gerado
  fullUrl String @db.Text

  // Estat√≠sticas
  clicks      Int   @default(0)
  conversions Int   @default(0) // Pedidos realizados
  revenue     Float @default(0)

  // Controle
  createdBy String? // ID do usu√°rio que criou
  isActive  Boolean @default(true)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([utmSource])
  @@index([utmCampaign])
  @@index([createdAt])
}

// ============================================
// INTEGRA√á√ïES
// ============================================

model Integration {
  id   String  @id @default(cuid())
  name String?

  platform IntegrationPlatform
  type     String // pixel, capi, analytics, etc.

  // Credenciais
  apiKey        String?
  apiSecret     String?
  pixelId       String?
  measurementId String?
  accessToken   String?

  // Configura√ß√£o
  config Json? // Configura√ß√µes espec√≠ficas

  isActive   Boolean   @default(true)
  lastSyncAt DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Logs de eventos
  eventLogs TrackingEvent[]

  @@unique([platform, type, pixelId])
}

// Log de eventos de tracking
model TrackingEvent {
  id String @id @default(cuid())

  integrationId String?
  integration   Integration? @relation(fields: [integrationId], references: [id], onDelete: SetNull)

  eventType String // page_view, purchase, add_to_cart, etc.
  eventData Json? // Dados do evento

  // Origem do tr√°fego
  pageUrl  String?
  referrer String?

  // Identificadores de cliques
  gclid  String? // Google Click ID
  fbclid String? // Facebook Click ID
  ttclid String? // TikTok Click ID

  // UTM parameters
  utmSource   String?
  utmMedium   String?
  utmCampaign String?
  utmContent  String?
  utmTerm     String?

  // Status do envio
  platform     String? // facebook, google, tiktok, etc.
  status       String  @default("pending") // pending, sent, failed
  statusCode   Int?
  errorMessage String?

  // Dados do usu√°rio
  userId    String?
  sessionId String?
  ipAddress String?
  userAgent String?

  createdAt DateTime @default(now())

  @@index([eventType])
  @@index([platform])
  @@index([status])
  @@index([gclid])
  @@index([fbclid])
  @@index([createdAt])
}

// Configura√ß√£o de Open Graph / Social Share
model SocialShareConfig {
  id String @id @default(cuid())

  // OG Tags padr√£o
  ogTitle       String?
  ogDescription String?
  ogImage       String?
  ogType        String  @default("website")

  // Twitter Card
  twitterCard    String  @default("summary_large_image")
  twitterSite    String?
  twitterCreator String?

  // Configura√ß√£o adicional
  siteName String?
  locale   String  @default("pt_BR")

  isActive Boolean @default(true)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Webhook {
  id String @id @default(cuid())

  name   String
  url    String
  method String @default("POST") // POST, GET, PUT

  // Dire√ß√£o do webhook
  direction WebhookDirection @default(OUTBOUND)

  // Eventos que disparam o webhook
  events String[] // order.created, order.confirmed, etc.

  // Headers customizados e seguran√ßa
  headers Json?
  secret  String? // Secret para valida√ß√£o

  // Controle
  isActive Boolean @default(true)

  // Estat√≠sticas
  lastTriggeredAt DateTime?
  successCount    Int       @default(0)
  failureCount    Int       @default(0)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  logs WebhookLog[]
}

model WebhookLog {
  id        String @id @default(cuid())
  webhookId String

  event      String
  status     WebhookStatus
  statusCode Int?

  // Dados da requisi√ß√£o/resposta
  requestBody  Json?
  responseBody String? @db.Text
  errorMessage String?

  // Tempo de execu√ß√£o
  duration Int? // em milissegundos

  triggeredAt DateTime @default(now())

  webhook Webhook @relation(fields: [webhookId], references: [id], onDelete: Cascade)

  @@index([webhookId])
  @@index([triggeredAt])
  @@index([status])
}

// ============================================
// MARKETING - EMAIL MARKETING
// ============================================

model EmailAutomation {
  id String @id @default(cuid())

  name        String
  description String?

  // Fluxo da automa√ß√£o (JSON com n√≥s e conex√µes)
  flow Json // {nodes: [], connections: []}

  isActive Boolean @default(true)
  isDraft  Boolean @default(true)

  // Estat√≠sticas
  totalExecutions Int @default(0)
  successCount    Int @default(0)
  failureCount    Int @default(0)

  createdBy String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  logs EmailAutomationLog[]
}

model EmailAutomationLog {
  id           String @id @default(cuid())
  automationId String

  // Dados da execu√ß√£o
  userId  String?
  email   String
  trigger String
  nodeId  String

  status       EmailAutomationStatus
  errorMessage String?

  executedAt DateTime @default(now())

  automation EmailAutomation @relation(fields: [automationId], references: [id], onDelete: Cascade)

  @@index([automationId])
  @@index([executedAt])
}

model EmailTemplate {
  id String @id @default(cuid())

  name        String
  subject     String
  htmlContent String  @db.Text
  textContent String? @db.Text

  // Configura√ß√µes
  fromName  String @default("SushiWorld")
  fromEmail String @default("pedidosushiworld@gmail.com")

  // Bot√£o personalizado
  buttonText  String?
  buttonUrl   String?
  buttonColor String? @default("#FF6B00")

  isActive Boolean @default(true)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model SmtpSettings {
  id String @id @default(cuid())

  // Servidor SMTP
  smtpServer   String  @default("smtp.gmail.com")
  smtpPort     Int     @default(587)
  smtpUser     String?
  smtpPassword String?
  useTls       Boolean @default(true)

  // Remetente padr√£o
  defaultFromName  String @default("SushiWorld")
  defaultFromEmail String @default("pedidosushiworld@gmail.com")

  // Anti-spam
  minDelaySeconds  Int @default(60) // Delay m√≠nimo entre emails
  maxDelaySeconds  Int @default(300) // Delay m√°ximo entre emails
  maxEmailsPerHour Int @default(100) // Limite por hora

  // Reten√ß√£o de dados
  emailRetentionDays Int @default(30) // Dias para manter emails

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

// ============================================
// MARKETING - PROMO√á√ïES INTELIGENTES
// ============================================

model SmartPromotion {
  id String @id @default(cuid())

  name        String
  description String?

  type SmartPromotionType // UPSELL, ORDER_BUMP, DOWNSELL

  // Gatilho
  triggerType  TriggerType? // PRODUCT, CATEGORY, CART, CART_VALUE
  triggerValue String? // ID do produto/categoria ou valor

  // Oferta
  offerProductId String? // Produto oferecido
  discountType   DiscountType // FIXED ou PERCENTAGE
  discountValue  Float

  // Mensagem
  title          String? @db.VarChar(35)
  message        String? @db.Text
  displayMessage String? @db.Text

  // Condi√ß√µes
  minCartValue    Float? // Valor m√≠nimo do carrinho
  timeRestriction Json? // {startHour, endHour}
  maxUses         Int? // Limite de uso por pedido

  // Controle
  priority    Int     @default(0) // Ordem de prioridade
  isMandatory Boolean @default(false) // Checkbox obrigat√≥rio
  isActive    Boolean @default(true)

  // Estat√≠sticas
  shownCount    Int   @default(0)
  acceptedCount Int   @default(0)
  revenue       Float @default(0)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  offerProduct Product? @relation(fields: [offerProductId], references: [id])
}

// ============================================
// CONFIGURA√á√ïES
// ============================================

model Settings {
  id String @id @default(cuid())

  // Empresa
  companyName String
  billingName String?
  nif         String
  address     String?
  phone       String?
  email       String?
  websiteUrl  String?

  // Hor√°rios de atendimento
  openingHours Json? // {monday: {open: "11:00", close: "23:00", closed: false}, ...}

  // Status do restaurante
  isOnline Boolean @default(true) // Restaurante online/offline (aceita pedidos)

  // IVA
  vatRate Float   @default(13)
  vatType VatType @default(INCLUSIVE)

  // Impressora
  printerType String? // USB, BLUETOOTH
  printerName String?
  paperSize   String? // 58mm, 80mm

  // Banners do site
  banners    Json? // Array de URLs
  bannerMode BannerMode @default(STATIC)

  // Popup promocional
  popupEnabled Boolean @default(false)
  popupConfig  Json? // {type, imageUrl, text, buttonText, buttonColor, link}

  // Configura√ß√µes de impress√£o
  printSettings Json? // {layout: [], footerMessage: ''}

  // Itens adicionais
  additionalItems         Json? // Array de itens opcionais no carrinho
  checkoutAdditionalItems Json? // Array de itens opcionais no checkout

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

// ============================================
// ENUMS
// ============================================

enum Role {
  ADMIN
  MANAGER
  CUSTOMER
}

enum ManagerLevel {
  BASIC // Apenas aceitar/cancelar/imprimir pedidos
  INTERMEDIATE // + Alterar pedidos
  FULL // Acesso total exceto financeiro e dados de clientes
}

enum ProductStatus {
  AVAILABLE
  OUT_OF_STOCK
  DISCONTINUED
}

enum NutritionPer {
  SERVING
  PER_100G
}

enum OptionType {
  REQUIRED
  OPTIONAL
}

enum DisplayAt {
  SITE
  CART
}

enum AssignmentType {
  SITE_WIDE // Aplica em todos os produtos
  CATEGORY // Aplica em produtos de uma categoria
  PRODUCT // Aplica em um produto espec√≠fico
}

enum OrderStatus {
  PENDING
  CONFIRMED
  CANCELLED
  PREPARING
  DELIVERING
  DELIVERED
}

enum PaymentMethod {
  CREDIT_CARD
  CASH
}

enum PrintStatus {
  SUCCESS
  FAILED
  PENDING
}

enum DeliveryType {
  FREE
  PAID
}

enum PromotionType {
  COUPON // Cupom de desconto
  FIRST_PURCHASE // Primeira compra
  ORDER_BUMP // Adicional no checkout
  UP_SELL // Upgrade de produto
  DOWN_SELL // Alternativa mais barata
}

enum DiscountType {
  FIXED
  PERCENTAGE
}

enum TriggerType {
  PRODUCT
  CATEGORY
  CART
  CART_VALUE
}

enum EmailType {
  TRANSACTIONAL // Confirma√ß√£o de pedido
  MARKETING // Campanhas
  AUTOMATION // Carrinho abandonado, etc.
}

enum EmailTrigger {
  ORDER_CONFIRMED
  ORDER_CANCELLED
  CART_ABANDONED
  FIRST_PURCHASE
  WELCOME
}

enum EmailStatus {
  SENT
  DELIVERED
  OPENED
  CLICKED
  BOUNCED
  FAILED
}

enum IntegrationPlatform {
  FACEBOOK
  GOOGLE_ADS
  GOOGLE_ANALYTICS
  GOOGLE_TAG_MANAGER
  TIKTOK
  TABOOLA
  PINTEREST
  CUSTOM
}

enum VatType {
  INCLUSIVE
  EXCLUSIVE
}

enum BannerMode {
  STATIC
  CAROUSEL
}

// ============================================
// MARKETING ENUMS
// ============================================

enum EmailAutomationStatus {
  SUCCESS
  FAILED
  PENDING
}

enum WebhookDirection {
  INBOUND // Recebe webhooks externos
  OUTBOUND // Envia webhooks
}

enum WebhookStatus {
  SUCCESS
  FAILED
  PENDING
}

enum SmartPromotionType {
  UPSELL // Upgrade de produto
  ORDER_BUMP // Adicional no checkout
  DOWNSELL // Alternativa mais barata
}

// ============================================
// M√âTRICAS CUSTOMIZADAS
// ============================================

model CustomMetric {
  id          String     @id @default(cuid())
  name        String
  description String?
  formula     String     @db.Text
  type        MetricType @default(FINANCIAL)
  unit        String     @default("‚Ç¨")
  isActive    Boolean    @default(true)
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
}

enum MetricType {
  FINANCIAL
  OPERATIONAL
  MARKETING
  CUSTOMER
}

// ============================================
// CONFIGURA√á√ïES DA EMPRESA
// ============================================

model CompanySettings {
  id String @id @default(cuid())

  // Configura√ß√µes de impress√£o
  printerSettings Json? // Armazena OrderReceiptConfig

  // Banner principal
  homeBannerImageUrl String?
  homeBannerTitle    String?
  homeBannerSubtitle String?
  homeBannerLinkUrl  String?
  homeBannerLinkText String?
  showHomeBanner     Boolean @default(true)

  // Informa√ß√µes da empresa
  companyName    String?
  companyAddress String?
  companyPhone   String?
  companyEmail   String?
  websiteUrl     String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

// ============================================
// PWA APP INSTALL TRACKING
// ============================================

model AppInstallLog {
  id String @id @default(cuid())

  // Tracking de origem (UTM)
  utmSource   String? // ex: qr, banner, email
  utmMedium   String? // ex: android_app, ios_app
  utmCampaign String? // ex: promo_natal

  // Informa√ß√µes t√©cnicas (an√¥nimas)
  userAgent  String  @db.Text // Para detectar SO/Browser
  ipHash     String // Hash SHA-256 do IP (nunca IP real)
  deviceType String? // android, ios, desktop, unknown

  // Eventos
  eventType   AppInstallEvent @default(LINK_CLICKED)
  isConverted Boolean         @default(false) // Se realmente instalou o app

  // Timestamps
  clickedAt   DateTime  @default(now())
  installedAt DateTime? // Quando detectou que foi instalado

  @@index([utmSource, utmMedium])
  @@index([eventType])
  @@index([clickedAt])
}

enum AppInstallEvent {
  LINK_CLICKED // Clicou no link de instala√ß√£o
  APP_INSTALLED // Instalou o app (detectado via beforeinstallprompt)
  APP_OPENED // Abriu o app instalado
}
